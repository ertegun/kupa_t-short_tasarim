<html>

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <link
    href='https://fonts.googleapis.com/css?family=Arizonia|Roboto|Lobster|Indie+Flower|Pacifico|Nunito|Sigmar+One|Open+Sans'
    rel='stylesheet' type='text/css' />
  <link href="assets/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
  <link href="assets/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
  <link href="assets/global/plugins/bootstrap-colorpicker/css/colorpicker.css" rel="stylesheet" type="text/css" />
  <link href="assets/global/plugins/jquery-minicolors/jquery.minicolors.css" rel="stylesheet" type="text/css" />
  <link href="assets/global/css/components-md.css" rel="stylesheet" type="text/css" id="style_components" />
  <link href="assets/global/plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css" rel="stylesheet"
    type="text/css" />
  <link href="assets/global/plugins/bootstrap-modal/css/bootstrap-modal.css" rel="stylesheet" type="text/css" />
  <link href="assets/global/plugins/bootstrap-toastr/toastr.min.css" rel="stylesheet" type="text/css" />
  <link href="lib/dropzone/css/dropzone.css" type="text/css" rel="stylesheet" />
  <script src="assets/global/plugins/jquery.min.js" type="text/javascript"></script>
  <script src="assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
  <script src="assets/global/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
  <script src="assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

  <script src="lib/fabric-js/dist/fabric.js"></script>
  <script src="lib/dropzone/js/dropzone.js"></script>
  <script>
  </script>
  <style>
    #uploadHere {
      color: red;
    }
  </style>
</head>

<body class="page-md page-header-fixed page-quick-sidebar-over-content">


  <div class="container">
    <div class="page-logo">
      <a href="index.html">
        <img src="image/jasper-magaza-logo.jpg" alt="logo" class="logo-default"> </a>
      <div class="menu-toggler sidebar-toggler"> </div>
    </div>
    <form action="inc/upload-original.php" class="dropzone dz-clickable" id="myAwesomeDropzone"
      style="border:3px solid silver; border-radius: 10px;"></form>
    <div class="row">
      <div class="col-md-4">
        <div class="portlet box green">
          <div class="portlet-title">
            <div class="caption">
              <i class="fa fa-edit"></i>Ayarlar
            </div>
          </div>
          <div class="portlet-body">
            <div class="table-scrollable">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th> </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td> Yazı Renk </td>
                    <td><input type="text" id="TextColorPicker" class="form-control demo" data-position="bottom left"
                        value="#000000" /></td>
                  </tr>
                  <tr>
                    <td> Arka Plan Renk </td>
                    <td><input type="text" id="BackgroundColorPicker" class="form-control demo"
                        data-position="bottom left" value="#ff0000" /></td>
                  </tr>
                  <tr>
                    <td> Yazı Tipi </td>
                    <td>
                      <select class="bs-select form-control" id="FontFamilyOpt">
                        <option value="Open Sans" style="font-family: 'Open Sans', sans-serif;">Open Sans</option>
                        <option value="Arizonia" style="font-family: 'Arizonia', cursive;">Arizonia</option>
                        <option value="Roboto" style="ffont-family: 'Roboto', sans-serif;">Roboto</option>
                        <option value="Lobster" style="font-family: 'Lobster', cursive;">Lobster</option>
                        <option value="Indie Flower" style="font-family: 'Indie Flower', cursive;">Indie Flower</option>
                        <option value="Pacifico" style="font-family: 'Pacifico', cursive;">Pacifico</option>
                        <option value="Nunito" style="font-family: 'Nunito', sans-serif;">Nunito</option>
                        <option value="Sigmar One" style="font-family: 'Sigmar One', cursive;">Sigmar One</option>
                      </select>
                    </td>
                  </tr>
                  <tr>
                    <td><a href="javascript:;" class="btn grey-cascade margin-top-10" id="addTextBtn"> Yazı Ekle
                        <i class="fa fa-edit"></i>
                      </a></td>
                    <td>
                      <div class="form-group form-md-line-input form-md-floating-label has-info">
                        <input type="text" class="form-control input-sm" id="myText" />
                        <label for="form_control_1">Yazı Ekle</label>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="portlet box blue-hoki">
          <div class="portlet-title">
            <div class="caption">
              <i class="fa fa-gift"></i>
              <div class="btn-group btn-group-xs btn-group-solid">
                <button type="button" class="btn red" id="bgKupa">Kupa</button>
                <!--<button type="button" class="btn green">Middle</button>-->
                <button type="button" class="btn blue" id="bgTshirt">Tişört</button>
              </div>
            </div>
            <div class="actions">
              <a href="javascript:deleteObject();" class="btn btn-default btn-sm" id="eraseObj">
                <i class="fa fa-eraser"></i> Sil </a>
              <a href="javascript:;" class="btn btn-default btn-sm" id="save">
                <i class="fa fa-save"></i> Kaydet </a>
            </div>
          </div>
          <div class="portlet-body" id="canvasDiv">
            <canvas id="c"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div id="responsive" class="modal fade">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      </div>
      <div class="modal-body">
        <div class="row-fluid">
          <div class="span6">
            <h3>İletişim Bilgileri</h3>
            <div class="portlet light portlet-fit portlet-form bordered">
              <form action="#" class="form-horizontal" id="form_sample_1" novalidate="novalidate">
                <div class="form-body">
                  <div class="alert alert-danger display-hide">
                    <button class="close" data-close="alert"></button> Bilgiler eksik kontrol ediniz.
                  </div>
                  <div class="alert alert-success display-hide">
                    <button class="close" data-close="alert"></button> Bilgiler doğru.
                  </div>
                  <div class="portlet-body">
                    <div class="form-group form-md-line-input">
                      <label class="col-md-3 control-label" for="form_control_1">Eposta
                        <span class="required" aria-required="true">*</span>
                      </label>
                      <div class="col-md-9">
                        <div class="input-group">
                          <span class="input-group-addon">
                            <i class="fa fa-envelope"></i>
                          </span>
                          <input type="text" class="form-control" name="email2" placeholder="Enter your email"
                            id="mail" />
                          <div class="form-control-focus"> </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-group form-md-line-input">
                      <label class="col-md-3 control-label" for="form_control_1">Telefon
                        <span class="required" aria-required="true">*</span>
                      </label>
                      <div class="col-md-9">
                        <div class="input-group">
                          <span class="input-group-addon">
                            <i class="fa fa-envelope"></i>
                          </span>
                          <input type="text" class="form-control" name="digits" placeholder="Telefon numaarası giriniz."
                            id="tel" />
                          <div class="form-control-focus"> </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-actions">
                      <div class="row">
                        <div class="col-md-12">
                          <button type="submit" class="btn green" id="send">Gönder</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <p>
                    <span class="label label-success"> NOT: </span>
                    &nbsp; İletişim bilgilerini lütfen kontrol ediniz.
                    Ürünün yapım aşamasında size geri dönüş yapılması için önemlidir.
                    GÖNDER 'e tıkladıktan sonra işleme alınması için bir ürün satın alınız.
                  </p>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer id="footer" class="container ">
      <div class="row ">
        <div class="clearfix"></div>
        <section class="footer-block text-center" id="block_various_links_footer">
          © 2016 <a href="http://www.jasperajans.com">Jasper Ajans </a>
        </section>
      </div>
    </footer>
  </div>
  <script src="assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
  <script src="assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
  <script src="assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
  <script src="assets/global/scripts/metronic.js" type="text/javascript"></script>
  <script src="assets/global/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js" type="text/javascript"></script>
  <script src="assets/global/plugins/jquery-minicolors/jquery.minicolors.min.js" type="text/javascript"></script>
  <script src="assets/pages/scripts/components-color-pickers.min.js" type="text/javascript"></script>
  <script src="assets/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript"></script>
  <script src="assets/global/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript"></script>
  <script src="assets/pages/scripts/ui-extended-modals.min.js" type="text/javascript"></script>
  <script src="assets/global/plugins/bootstrap-toastr/toastr.min.js" type="text/javascript"></script>
  <script src="assets/pages/scripts/ui-toastr.min.js" type="text/javascript"></script>
  <script src="assets/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
  <script src="assets/global/plugins/jquery-validation/js/additional-methods.min.js" type="text/javascript"></script>
  <script src="assets/pages/scripts/form-validation-md.min.js" type="text/javascript"></script>
  <script src="assets/form_validation_messages_tr.js" type="text/javascript"></script>
  <script src="assets/global/scripts/app.min.js" type="text/javascript"></script>
  <script>

    var canvas = new fabric.Canvas('c');
    canvas.setHeight(500);
    canvas.setWidth($('#canvasDiv').width());
    Dropzone.options.myAwesomeDropzone = {
      paramName: "file", // The name that will be used to transfer the file
      maxFilesize: 10, // MB
      acceptedFiles: 'image/*',
      accept: function (myFile, done) {
        done();
        var file = myFile;
        console.log("file");
        var reader = new FileReader();

        reader.onload = function (f) {
          var data = f.target.result;
          fabric.Image.fromURL(data, function (img) {
            var oImg = img.set({ left: 50, top: 100, angle: 00 }).scale(0.2);
            canvas.add(oImg).renderAll();
            canvas.setActiveObject(oImg);
          });
        };
        reader.readAsDataURL(file);
      },
      dictDefaultMessage: '<img src="image/cloud-upload-icon.png"/>',
      //      dictDefaultMessage: '<span id="uploadHere">Resim Yüklemek İçin Buraya Tıkla</span>',
      dictRemoveFile: 'Sil',
      dictInvalidFileType: 'Sadece Resim Yüklenebilir',
      dictFallbackMessage: 'Tarayıcınız Sürekle Bırak Özelliğini Desteklemiyor',
    };

    toastr.options = {
      "closeButton": true,
      "debug": false,
      "positionClass": "toast-top-center",
      "onclick": null,
      "showDuration": "1000",
      "hideDuration": "1000",
      "timeOut": "9000",
      "extendedTimeOut": "1000",
      "showEasing": "swing",
      "hideEasing": "linear",
      "showMethod": "fadeIn",
      "hideMethod": "fadeOut"
    }

    $(document).ready(function () {
      Metronic.init(); // init metronic core components

      var goToShop = 'https://www.jaspermagaza.com/tisort/368-online-tisort-tasarla-tisortunuzu-kisisellestirin.html';
      $("#bgKupa").click(function () {
        goToShop = 'https://www.jaspermagaza.com/kupa-bardak/367-online-kupa-tasarla-kupanizi-kisisellestirin.html';
        canvas.setBackgroundImage('image/bardak.png', canvas.renderAll.bind(canvas), {
          scaleY: 3 / 10,
          scaleX: 2 / 5,
        });
      });

      $("#bgTshirt").click(function () {
        var goToShop = 'https://www.jaspermagaza.com/tisort/368-online-tisort-tasarla-tisortunuzu-kisisellestirin.html';
        canvas.setBackgroundImage('image/t-shirt.jpg', canvas.renderAll.bind(canvas), {
          scaleY: 3 / 9,
          scaleX: 3 / 5,
        });
      });

      canvas.setBackgroundImage('image/t-shirt.jpg', canvas.renderAll.bind(canvas), {
        scaleY: 3 / 9,
        scaleX: 3 / 5,
      });

      $("#addFile").click(function () {
        $("#myAwesomeDropzone").trigger('click');
      });

      $("#save").click(function () {
        $('#responsive').modal();
      });

      $("#send").click(function () {
        var form = $("#form_sample_1");

        if (form.valid()) {
          $("#send").html('<i class="fa fa-spinner fa-spin fa-2x"></i>');
          $("#send").addClass('disabled');
          var userInfo = $('#tel').val() + '***' + $('#mail').val();
          canvas.add(new fabric.IText(userInfo, {
            fontFamily: 'arial',
            fontSize: 28,
            fill: '#000000',
            textBackgroundColor: '#ffffff',
            left: 5,
            top: 5,
            textAlign: 'center'
          }));
          canvas.deactivateAll().renderAll();
          canvas.renderAll();
          var image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
          $.ajax({
            type: "POST",
            url: "inc/upload-canvas.php",
            data: { image: image },
            success: function (response) {
              $("#send").html('<i class="fa fa-check fa-2x"></i>');
              $("#send").addClass('btn-success');
              console.log(response);
              toastr.success('Tasarımınız kaydedildi.Satın alma sayfasına yönlendirileceksiniz.', 'Başarılı');
              setTimeout(function () {
                window.location.href = goToShop;
              }, 8000);
            },
            error: function (response) {
              console.log('hata');
            }
          });
        }
      });

      canvas.add(new fabric.IText("  Örnek yazı düzenlemek için çift tıkla  ", {
        fontFamily: $('#FontFamilyOpt').val(),
        fontSize: 22,
        fill: $("#TextColorPicker").val(),
        textBackgroundColor: $("#BackgroundColorPicker").val(),
        left: 10,
        top: 10,
        textAlign: 'center'
      }));

      $("#TextColorPicker").change(function () {
        textColor = $(this).val();

        var obj = canvas.getActiveObject();
        obj.id = 'mytext';
        console.log(obj.toJSON());
        if (!obj)
          return;
        obj.setFill(textColor);
        canvas.renderAll();
      });

      $("#FontFamilyOpt").change(function () {
        console.log(this.value);
        font = this.value;
        var obj = canvas.getActiveObject();
        if (!obj)
          return;
        obj.setFontFamily(font);
        canvas.renderAll();
      });

      $("#BackgroundColorPicker").change(function () {
        textColor = $(this).val();

        var obj = canvas.getActiveObject();
        if (!obj)
          return;
        obj.setTextBackgroundColor(textColor);
        canvas.renderAll();
      });


      $("#addTextBtn").click(function () {
        canvas.add(new fabric.IText($('#myText').val(), {
          fontFamily: $("#FontFamilyOpt").val(),
          fontSize: 22,
          fill: $("#TextColorPicker").val(),
          textBackgroundColor: $("#BackgroundColorPicker").val(),
          left: 100,
          top: 100,
          textAlign: 'center'
        }));
        $('#myText').val('');
        canvas.deactivateAll().renderAll();
      });

      $('#eraseObj').hide();
      $("#canvasDiv canvas").click(function () {
        var activeObj = canvas.getActiveObject();

        if (activeObj !== null) {
          var typeObj = canvas.getActiveObject().get('type');
          var color = canvas.getActiveObject().get('fill');
          var bgColor = canvas.getActiveObject().get('textBackgroundColor');
          if (typeObj === 'i-text') {
            $('.minicolors-swatch-color:eq(-1)').css("background-color", bgColor);//arkaplan renk
            $('.minicolors-swatch-color:eq(-2)').css("background-color", color);//şekil yazı renk
            $('#TextColorPicker').val(color);
            $('#BackgroundColorPicker').val(bgColor);

          } else if (typeObj === 'circle' || typeObj === 'rect') {
            $('.minicolors-swatch-color:eq(-2)').css("background-color", color);//şekil yazı renk
            $('#TextColorPicker').val(color);
          }

          $('#eraseObj').show();
        } else {
          $('#eraseObj').hide();
        }
      });
    });//document ready

    function deleteObject() {
      if (canvas.getActiveObject() !== null) {
        //            console.log(canvas.getActiveObject());
        canvas.getActiveObject().remove();
      }
    }

  </script>
</body>

</html>